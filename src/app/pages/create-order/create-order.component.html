<div class="create-order-container" *ngIf="_.size(service._loading.loadingMap)==0">

    <div class="container-fluid">

        <ng-container *ngIf="!_.isUndefined(agentProdcuts)">
            
            <ng-container *ngIf="_.size(agentProdcuts) == 0;else agentProductsPage">
            
                <div class="empty-page">

                    <div class="empty-content">
            
                        <h4 class="fw-600">You have not added any products</h4>
                    
                        <div class="emptyIcon" style="background: url(./assets/images/empty-list.png);"></div>
                        
                        <a class="btn btn-md btn-primary bi bi-plus-lg" (click)="openAsidebar({ canvasName: 'addProduct' })">
                        
                            <span class="ms-3">Add New</span>
                        
                        </a>

                    </div>

                </div>

            </ng-container>

        </ng-container>

        <ng-template #agentProductsPage>

            <div class="row mt-2">

                <div class="col-xl-8 col-md-6 pe-0">

                    <div class="row mb-2" [formGroup]="filterForm">

                        <div class="col-sm-6 col-md-5 col-xl-3 mb-2">
    
                            <input type="text" class="form-control form-control-lg border-2" formControlName="search" placeholder="Search by item name...">
                
                        </div>
            
                        <div class="col-sm-6 col-md-4 col-xl-3 mb-2">
            
                            <custom-ng-select 
                                [value]="filterForm.controls.categoryId?.value"
                                [from]="filterForm"     
                                formControlField="areaId"
                                [multiple]="true"
                                [items]="masterList['categoryList']"
                                bindLabel="item?.categoryName.toTitleCase()"
                                bindValue="_id"
                                placeholder="Categories"
                            ></custom-ng-select>                
                
                        </div>
        
                        <div class="col-md-3 col-xl-5 mb-2 align-self-center text-end mb-md-0 mb-2">
            
                            <a class="btn btn-lg text-primary bg-primary-subtle fs-6 bi-file-earmark-plus" [routerLink]="'/pages/account-setup/item-pricing'" [queryParams]="{ 'view': 'other-products' }">
            
                                Add Item

                            </a>
            
                        </div>                          

                    </div>

                    <div class="fw-500 text-secondary"><span class="fs-5">Products</span> ({{agentProductsCount}})</div>

                    <div class="product-section">

                        <div class="d-flex flex-wrap">
    
                            <a class="card product-card border-2 m-2" *ngFor="let productDet of agentProdcuts" (click)="openAsidebar({ 'canvasName': 'addBasket', 'data': productDet })">
        
                                <div class="card-body">
    
                                    <i class="bx bx-plus rounded"></i>
        
                                    <div class="product-image mx-auto" style="background : url({{productDet?.productId?.productImageURL}});width: 150px;height: 150px;"></div> 
        
                                    <div class="d-flex justify-content-center">
        
                                        <a class="h5 mb-0 mt-3 text-center text-primary" (click)="openAsidebar(productDet)">
                                            
                                            {{productDet?.productId?.productName}}
        
                                        </a>
        
                                    </div>
        
                                </div>
            
                            </a>
    
                        </div>

                    </div>

                </div>

                <div class="col-xl-4 col-md-6 ps-0 ">

                    <div class="create-order-section border-2 border-start">

                        <div class="card-header p-3 d-flex justify-content-between border-2 border-bottom">

                            <span class="modal-title text-secondary h6 mb-0">CART</span>

                            <div class="d-flex align-items-center text-primary-emphasis fs-6">

                                <i class="bx bx-refresh fs-5"></i>
    
                                <span class="fst-normal fw-medium">Reset</span>

                            </div>
                        
                        </div>

                        <div class="card-body" [formGroup]="orderForm">

                            <mat-accordion multi>

                                <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">

                                    <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white">

                                        <div class="mb-0 text-primary fw-500 small">Customer</div>
            
                                    </mat-expansion-panel-header>

                                    <div class="py-3">
                                    
                                        <div class="d-flex align-items-center">
            
                                            <ng-select class="form-control form-control-lg border-2" placeholder="Search Customers" formControlName="customerId" [clearable]="false" (scrollToEnd)="getCustomers()" (change)="selectedCustomerDet = _.find(masterList['customerList'],{ '_id': f.customerId.value })">

                                                <ng-option *ngFor="let customerDet of masterList['customerList']" [value]="customerDet._id">

                                                    {{customerDet.firstName + ' ' + customerDet.lastName}}

                                                </ng-option>

                                            </ng-select>
                
                                            <button class="btn rounded-pill ms-3" style="width: 45px;height: 45px;background: #288BE6;" (click)="openAsidebar({ 'canvasName': 'addCustomer' })">
                
                                                <img src="./assets/images/add-user.svg">
                
                                            </button>
            
                                        </div>
            
                                        <div class="mt-3" style="min-height: 175px;" [ngClass]="{ 'd-flex justify-content-center align-items-center': _.isEmpty(selectedCustomerDet)  }">
            
                                            <ng-container *ngIf="_.isEmpty(selectedCustomerDet); else customerInfo">
            
                                                <p class="text-secondary">No Customer Added</p>
                                            
                                            </ng-container>
            
                                            <ng-template #customerInfo>

                                                <div class="d-flex align-items-center border-bottom border-1 py-3 px-2">

                                                    <div class="customer-image product-image" style="background: url({{selectedCustomerDet?.customerImageURL}}); width: 35px; height: 35px;"></div>

                                                    <h6 class="ms-2 mb-0 fw-600">{{selectedCustomerDet?.firstName + ' ' + selectedCustomerDet?.lastName}}</h6>

                                                </div>
                                            
                                                <div class="d-flex align-items-start border-bottom border-1 py-3 px-2">

                                                    <i class="bi bi-geo-alt text-primary fs-5"></i>

                                                    <p class="ms-2 mb-0 fw-500 text-secondary" *ngIf="selectedCustomerDet?.addressInfo as addressDet">

                                                        {{ addressDet?.street }}, 
                                                        {{ !_.isEmpty(addressDet?.block) ? addressDet?.block + ',' : ''}} 
                                                        {{ !_.isEmpty(addressDet?.building) ? addressDet?.building + ',' : '' }}
                                                        {{ addressDet?.areaId?.name }}, 
                                                        {{ addressDet?.cityId?.name }}, 
                                                        {{ addressDet?.countryId?.name }} - 
                                                        {{ addressDet?.zipcode }}

                                                    </p>

                                                </div>

                                                <div class="d-flex align-items-center pt-3 px-2">

                                                    <div class="d-flex">

                                                        <i class="bi bi-telephone text-primary fs-5"></i>

                                                        <p class="ms-2 mb-0 fw-500 text-secondary">{{ selectedCustomerDet?.dialCode }} {{selectedCustomerDet?.mobile}}</p>

                                                    </div>

                                                    <div class="d-flex ms-auto">

                                                        <i class="bi bi-envelope text-primary fs-5"></i>

                                                        <p class="ms-2 mb-0 fw-500 text-secondary">{{selectedCustomerDet?.email}}</p>

                                                    </div>

                                                </div>
            
                                            </ng-template>
            
                                        </div>
            
                                    </div>                                    

                                </mat-expansion-panel>

                                <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">

                                    <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white" >

                                        <div class="mb-0 text-primary fw-500 small">Items</div>
            
                                    </mat-expansion-panel-header>

                                    <div class="py-3">
                                        
                                        <div class="mt-2" style="min-height: 175px;" [ngClass]="{ 'd-flex justify-content-center align-items-center': _.isEmpty(f.itemList.controls)  }">
    
                                            <ng-container *ngIf="_.isEmpty(f.itemList.controls); else basketInfo">
            
                                                <p class="text-secondary">No Items Added</p>
                                            
                                            </ng-container>
            
                                            <ng-template #basketInfo>
            
            
                                            </ng-template>
            
                                        </div>   
            
                                    </div>

                                </mat-expansion-panel>

                                <ng-container *ngIf="!_.isEmpty(f.itemList.controls)">

                                    <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">
    
                                        <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white">
    
                                            <div class="mb-0 text-primary fw-500 small">Pickup & Delivery</div>
                
                                        </mat-expansion-panel-header>
    
                                        <div class="mt-2" style="min-height: 175px;">
        
                                        </div>
    
                                    </mat-expansion-panel>
    
                                    <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">
    
                                        <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white">
    
                                            <div class="mb-0 text-primary fw-500 small">Check Out</div>
                
                                        </mat-expansion-panel-header>
    
                                        <div class="mt-2" style="min-height: 175px;">

            
                                        </div>
    
                                    </mat-expansion-panel>
                                
                                </ng-container>

                            </mat-accordion>                            

                        </div>

                        <div class="card-footer border-top border-2 px-3 py-2 pt-3">

                            <button class="btn btn-primary btn btn-lg btn-primary fw-light fs-6">

                                <i class="bi bi-file-earmark-plus"></i>
                                
                                Create New Order
                            
                            </button>

                        </div>

                    </div>

                </div>

            </div>

        </ng-template>   

    </div>

</div>

<asidebar #canvas [title]="canvasTitle" [openCanvas]="openCanvas" (onClose)="openCanvas = false" (onSubmit)="asidebarSubmit()">

    <ng-container *ngIf="canvasName == 'addCustomer'">
    
        <div class="row" *ngIf="customerForm" [formGroup]="customerForm">

            <div class="col-sm-6 pe-sm-1">
    
                <div class="form-group">
    
                    <label for="firstName"> First Name </label>
                    
                    <input type="text" class="form-control form-control-lg" id="firstName" formControlName="firstName" placeholder="Enter Name" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.firstName.touched) && cusf.firstName.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.firstName.touched) && cusf.firstName.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.firstName.errors.required">First Name is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="col-sm-6 ps-sm-1">
    
                <div class="form-group">
    
                    <label for="lastName"> Last Name </label>
                    
                    <input type="text" class="form-control form-control-lg" id="lastName" formControlName="lastName" placeholder="Enter Name" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.lastName.touched) && cusf.lastName.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.lastName.touched) && cusf.firstName.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.lastName.errors.required">Last Name is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="form-group">
    
                <label for="mobile">Mobile Number</label>
    
                <div class="input-group">
                
                    <div class="input-group-prepend me-1">
                
                        <ng-select formControlName="dialCode" [clearable]="false" placeholder="+91" class="form-control"
                            [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.dialCode.touched) && cusf.dialCode.errors }">
                
                            <ng-option *ngFor="let dialCodeDet of masterList['dialCodeList']" [value]="dialCodeDet.dialCode">
                
                                <img class="country-flag" alt="{{ dialCodeDet.iso2 }}"
                                    src="http://purecatamphetamine.github.io/country-flag-icons/3x2/{{ dialCodeDet['iso2'] }}.svg" /> {{
                                dialCodeDet.dialCode }}
                
                            </ng-option>
                
                        </ng-select>
                
                    </div>
                
                    <input type="text" class="form-control" id="mobile" formControlName="mobile" placeholder="Enter"
                        [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.mobile.touched) && cusf.mobile.errors }" numbersOnly maxlength="10">
                
                    <div *ngIf="(formSubmitted.customerForm || cusf.mobile.touched) && cusf.mobile.errors" class="invalid-feedback">
                
                        <div *ngIf="cusf.mobile.errors.required">Mobile number is required</div>
                
                    </div>
                
                </div>
    
            </div>
    
            <div class="col-md-8 pe-2 pe-md-1">
    
                <div class="form-group">
    
                    <label for="email"> Email </label>
                    
                    <input type="email" class="form-control form-control-lg" id="email" formControlName="email" placeholder="Enter Email" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.email.touched) && cusf.email.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.email.touched) && cusf.email.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.email.errors.required">Email is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="col-md-4 ps-2 ps-md-1">            
    
                <div class="form-group">
    
                    <label for="gender">Gender</label>
    
                    <ng-select class="form-control form-control-lg border-2" placeholder="Select Gender" formControlName="gender" [clearable]="false">
    
                        <ng-option *ngFor="let gender of ['male','female','others']" [value]="gender">
    
                            {{ gender | uppercase }}
    
                        </ng-option>
    
                    </ng-select>
    
                </div>
    
            </div>        
    
            <ng-container [formGroup]="cusf.addressDetails">
    
                <div class="form-group mb-4">
                
                    <label for="street">NO & STREET/ROAD *</label>
    
                    <input type="text" class="form-control form-control-lg" id="street" formControlName="street"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.street.touched) && af.street?.errors }">
    
                </div>
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group mb-4">
    
                        <label for="building">APARTMENT, BUILDING, FLAT</label>
    
                        <input type="text" class="form-control form-control-lg" id="building" formControlName="building"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.building.touched) && af.building?.errors }">
    
                    </div>
    
                </div>
    
                <div class="col-md-6 ps-2 ps-md-1">            
    
                    <div class="form-group mb-4">
    
                        <label for="block">BLOCK</label>
    
                        <input type="text" class="form-control form-control-lg" id="block" formControlName="block"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.block.touched) && af.block?.errors }">
    
                    </div>
    
                </div>
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group">
    
                        <label for="countryId">Country</label>
    
                        <ng-select formControlName="countryId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.countryId?.touched) && af.countryId?.errors }">
    
                            <ng-option *ngFor="let countryDet of masterList['countryList']" [value]="countryDet._id">
                                
                                {{ countryDet.name | uppercase }}
                        
                            </ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || af.countryId?.touched) && af.countryId?.errors" class="invalid-feedback">
    
                            <div *ngIf="af.countryId.errors.required">Country is required</div>
    
                        </div>
    
                    </div>
    
                </div>
    
                <div class="col-md-6 ps-2 ps-md-1">
    
                    <div class="form-group">
    
                        <label for="stateId">State</label>
    
                        <ng-select formControlName="stateId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.stateId.touched) && af.stateId?.errors }" [readonly]="_.size(masterList['stateList']) == 0">
    
                            <ng-option *ngFor="let stateDet of masterList['stateList']" [value]="stateDet._id">{{ stateDet.name | uppercase }}</ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || af.stateId.touched) && af.stateId.errors" class="invalid-feedback">
    
                            <div *ngIf="af.stateId.errors.required">State is required</div>
    
                        </div>
    
                    </div>
    
                </div>
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group">
    
                        <label for="cityId">City</label>
    
                        <ng-select formControlName="cityId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.cityId.touched) && af.cityId?.errors }"  [readonly]="_.size(masterList['cityList']) == 0">
    
                            <ng-option *ngFor="let cityDet of masterList['cityList']" [value]="cityDet._id">{{ cityDet.name | uppercase }}</ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || af.cityId.touched) && af.cityId.errors" class="invalid-feedback">
    
                            <div *ngIf="af.cityId.errors.required">City is required</div>
    
                        </div>
    
                    </div>                                
    
                </div>   
    
                <div class="col-md-6 ps-2 ps-md-1">
    
                    <div class="form-group">
    
                        <label for="areaId">Area</label>
    
                        <ng-select formControlName="areaId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.areaId?.touched) && af.areaId?.errors }" [readonly]="_.size(masterList['areaList']) == 0">
    
                            <ng-option *ngFor="let areaDet of masterList['areaList']" [value]="areaDet._id">{{ areaDet.name | uppercase }}</ng-option>
    
                        </ng-select>                                        
    
    
                        <div *ngIf="(formSubmitted.customerForm || af.areaId?.touched) && af.areaId.errors" class="invalid-feedback">
    
                            <div *ngIf="af.areaId.errors.required">Area is required</div>
    
                        </div>
    
                    </div>                                
    
                </div> 
                
                <div class="col-sm-6">
    
                    <div class="form-group">
    
                        <label for="zipcode">PINCODE *</label>
        
                        <input type="text" class="form-control form-control-lg" id="zipcode" formControlName="zipcode"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || af.zipcode.touched) && af.zipcode?.errors }">
    
                        <div *ngIf="(formSubmitted.customerForm || af.zipcode?.touched) && af.zipcode?.errors" class="invalid-feedback">
    
                            <div *ngIf="af.zipcode.errors.required">Pincode is required</div>
    
                        </div>
        
                    </div>
    
                </div>
    
            </ng-container>     
    
        </div>    

    </ng-container>

    <ng-container *ngIf="canvasName == 'addBasket'">

        

    </ng-container>

</asidebar>