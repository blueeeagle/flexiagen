<div class="create-order-section">

    <div class="row">

        <div class="col-xxl-9 col-xl-8 col-lg-7">

            <mat-accordion>
        
                <mat-expansion-panel class="mat-elevation-z1 border" [ngClass]="{ 'mb-3': step != 0 }" [expanded]="step === 0" hideToggle disabled>
            
                    <mat-expansion-panel-header 
                        class="px-1 rounded-0 px-3" 
                        [ngClass]="{ 'bg-primary-subtle': step === 0 }" 
                        [style]="{ 'height': (!_.isEmpty(selectedCustomerDet) && step != 0 ? '100' : '60') + 'px !important' }">
        
                        <mat-panel-title class="fw-600 mat-expansion-panel-header-title" [ngClass]="step === 0 ? 'text-primary-emphasis' : 'text-secondary'"> 
        
                            <div class="d-flex w-100 justify-content-between">
        
                                <div class="d-block">
        
                                    <div class="d-flex align-items-center">
            
                                        <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis"  [ngClass]="step === 0 ? 'bg-white' : 'bg-secondary-subtle'">1</div> 
                                        
                                        CUSTOMER DETAILS 
                
                                        <i class="bi bi-check-lg fs-4 ms-2 ng-star-inserted text-primary" *ngIf="!_.isEmpty(selectedCustomerDet) && step != 0"></i>
            
                                    </div>
        
                                    <ng-container *ngIf="!_.isEmpty(selectedCustomerDet) && step != 0">
        
                                        <div class="d-flex">
        
                                            <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis opacity-0"  [ngClass]="step === 0 ? 'bg-white' : 'bg-secondary-subtle'">1</div> 
            
                                            <p class="fw-600 mb-0 text-black">{{ selectedCustomerDet.firstName + " " + selectedCustomerDet.lastName }}</p>
        
                                        </div>
                                    
                                    </ng-container>
        
                                </div>
        
                                <div class="d-block">
        
                                    <button class="btn text-primary border border-2 border-secondary-subtle btn-sm rounded px-3" *ngIf="!_.isEmpty(selectedCustomerDet) && step != 0" (click)="step = 0">CHANGE</button>
        
                                </div>                        
        
                            </div>
                        
                        </mat-panel-title>
        
                    </mat-expansion-panel-header>
        
                    <div class="rounded-2 p-4" [formGroup]="orderForm">
        
                        <div class="d-flex align-items-center mb-3" *ngIf="_.isEmpty(selectedCustomerDet)">
        
                            <input class="form-control form-control-lg border-1 w-100" type="text" placeholder="Search By Mobile or Email" formControlName="searchCustomer" (keyup)="formSubmitted.customerSearched = false;" style="max-width: 360px;">
        
                            <button class="btn ms-2 d-flex align-items-center justify-content-center text-white" style="width: 45px;height: 45px;background: #288BE6;" (click)="formSubmitted.customerSearched ? openAsidebar({ 'canvasName': 'addCustomer' }) : searchCustomer()">
                    
                                <img src="./assets/images/add-user.svg" *ngIf="formSubmitted.customerSearched">
        
                                <i class="bx bx-search-alt h3 mb-0 lh-1" *ngIf="!formSubmitted.customerSearched"></i>
        
                            </button>
        
                        </div>
        
                        <ng-container *ngIf="!_.isEmpty(selectedCustomerDet) && selectedCustomerDet as customerDet; else noCustomers">
        
                            <div class="d-flex">
        
                                <label class="small text-secondary me-2" style="width: 60px;">Name</label>
        
                                <p class="small fw-600">{{ customerDet.firstName + " " + customerDet.lastName }}</p>
        
                                <a class="text-primary" (click)="orderForm.patchValue({ 'customerDetails': null, 'customerId': null, 'isExistingCustomer': true, 'selectedAddr': -1 }); selectedCustomerDet = {};">
        
                                    <i class="bi bi-pencil-square ms-3"></i> Edit  
        
                                </a>
        
                            </div>
        
                            <div class="d-flex">
        
                                <label class="small text-secondary me-2" style="width: 60px;">Email</label>
        
                                <p class="small fw-600">{{ customerDet.email }}</p>
        
                            </div>
        
                            <div class="d-flex">
        
                                <label class="small text-secondary me-2" style="width: 60px;">Phone</label>
        
                                <p class="small fw-600">{{ customerDet.dialCode + "" + customerDet.mobile }}</p>
        
                            </div>
        
                            <div class="d-flex align-items-center">
        
                                <ng-container  *ngIf="!f.isExistingCustomer.value;">
        
                                    <button class="btn btn-primary btn-sm rounded px-3" (click)="sendCustomerVerification({})">VERIFY CUSTOMER</button>
        
                                    <p class="ms-2 mb-0 small text-light" style="font-size: 12px;">
                                        
                                        to continue with this order.
                                    
                                    </p>
                                
                                </ng-container>
        
                                <ng-container *ngIf="f.isExistingCustomer.value">
                                    
                                    <button class="btn btn-primary btn-sm rounded px-5" (click)="step = 1">CONTINUE ORDER</button>
        
                                </ng-container>
        
                            </div>
        
                        </ng-container>
        
                        <ng-template #noCustomers>
        
                            <div class="d-flex align-items-center justify-content-center alert alert-secondary pb-0 pt-3">
        
                                <p class="small text-secondary">No customer found {{ formSubmitted.customerSearched ? 'with this mobile or email' : '' }}</p>
        
                            </div>
        
                        </ng-template>
        
                    </div>
            
                </mat-expansion-panel>  
        
                <mat-expansion-panel class="mat-elevation-z1 border" [ngClass]="{ 'mb-3': step != 1 }" [expanded]="step === 1" hideToggle disabled>
            
                    <mat-expansion-panel-header 
                        class="px-1 rounded-0 px-3" 
                        [ngClass]="{ 'bg-primary-subtle': step === 1 }"  
                        [style]="{ 'height': (f.selectedAddr.value > -1 && step != 1 ? '100' : '60') + 'px !important' }">
        
                        <mat-panel-title class="fw-600 mat-expansion-panel-header-title" [ngClass]="step === 1 ? 'text-primary-emphasis' : 'text-secondary'"> 
        
                            <div class="d-flex w-100 justify-content-between">
        
                                <div class="d-block">
        
                                    <div class="d-flex align-items-center">
            
                                        <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis"  [ngClass]="step === 1 ? 'bg-white' : 'bg-secondary-subtle'">2</div> 
                                        
                                        ADDRESS DETAILS
                
                                        <i class="bi bi-check-lg fs-4 ms-2 ng-star-inserted text-primary" *ngIf="f.selectedAddr.value > -1 && step != 1"></i>
            
                                    </div>
        
                                    <ng-container *ngIf="f.selectedAddr.value > -1 && step != 1 && selectedCustomerDet?.addresses[f.selectedAddr.value] as addressDetail">
        
                                        <div class="d-flex">
        
                                            <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis opacity-0"  [ngClass]="step === 1 ? 'bg-white' : 'bg-secondary-subtle'">1</div> 
            
                                            <p class="fw-600 mb-0 text-black">
                                                
                                                {{ addressDetail.street | uppercase }}
        
                                                <ng-container *ngIf="addressDetail.block || addressDetail.building">
                                                
                                                    {{ (addressDetail.block ? (addressDetail.block + ' Block, ') : '') + ' ' + (addressDetail.building ? (addressDetail.building + ' Building') : '') }}
        
                                                </ng-container>
        
                                                {{ addressDetail.cityId.name + ', '+ addressDetail.stateId.name + ' - ' + addressDetail.zipcode }} 
        
                                                {{ addressDetail.countryId.name }}
                                            
                                            </p>
        
                                        </div>
                                    
                                    </ng-container>
        
                                </div>
        
                                <div class="d-block">
        
                                    <button class="btn text-primary border border-2 border-secondary-subtle btn-sm rounded px-3" *ngIf="f.selectedAddr.value > -1 && step != 1" (click)="step = 1">CHANGE</button>
        
                                </div>                        
        
                            </div>                        
                            
                        </mat-panel-title>
        
                    </mat-expansion-panel-header>
        
                    <div class="rounded-2 small">
        
                        <a class="d-flex p-3 border-bottom" *ngFor="let addressDet of selectedCustomerDet?.addresses || []; let i =index"  [style]="{ 'background': (f.selectedAddr.value == i ? '#F3F5F9' : '#FFF') }" [ngClass]="{ 'text-secondary': f.selectedAddr.value == i }">
        
                            <div [formGroup]="orderForm" (click)="orderForm.patchValue({ 'selectedAddr': i })">
        
                                <input type="radio" class="form-check-input" id="address-{{i}}" formControlName="selectedAddr" [value]="i" name="selectedAddr">
        
                            </div>
        
                            <div class="w-100 ms-3">
        
                                <a class="w-100" (click)="orderForm.patchValue({ 'selectedAddr': i })">
                                    <p class="mb-1">
        
                                        {{ addressDet.street | uppercase }}
            
                                        <ng-container *ngIf="addressDet.block || addressDet.building">
                                        
                                            {{ (addressDet.block ? (addressDet.block + ' Block, ') : '') + ' ' + (addressDet.building ? (addressDet.building + ' Building') : '') }}
            
                                        </ng-container>
            
                                    </p>
            
                                    <p class="mb-1">{{ addressDet.landmark }}</p>
            
                                    <p class="mb-1">{{ addressDet.cityId.name + ', '+ addressDet.stateId.name + ' - ' + addressDet.zipcode }} </p>
            
                                    <p>{{ addressDet.countryId.name }}</p>
                                        
                                </a>
        
                                <button class="btn btn-primary btn-sm rounded px-5" *ngIf="f.selectedAddr.value == i" (click)="step = 2">DELIVERY HERE</button>
        
                            </div>
                        
                        </a>
        
                        <!-- <div class="d-flex p-3">
        
                            <a class="text-primary cursor-pointer">
        
                                <i class="fa fa-plus me-2"></i>
                                
                                Add New Address
                            
                            </a>
        
                        </div> -->
                        
                    </div>
            
                </mat-expansion-panel>
        
                <mat-expansion-panel class="mat-elevation-z1 border" [ngClass]="{ 'mb-3': step != 2 }" [expanded]="step === 2" hideToggle disabled>
            
                    <mat-expansion-panel-header 
                        class="px-1 rounded-0 px-3" 
                        [ngClass]="{ 'bg-primary-subtle': step === 2 }" 
                        [style]="{ 'height': (!_.isEmpty(f.itemList.controls) && step != 2 ? '100' : '60') + 'px !important' }">
        
                        <mat-panel-title class="fw-600 mat-expansion-panel-header-title" [ngClass]="step === 2 ? 'text-primary-emphasis' : 'text-secondary'">
                            
                            <div class="d-flex w-100 justify-content-between align-items-center">
        
                                <div class="d-block">
        
                                    <div class="d-flex align-items-center">
            
                                        <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis"  [ngClass]="step === 2 ? 'bg-white' : 'bg-secondary-subtle'">3</div> 
                                    
                                        BASKET DETAILS
                
                                        <i class="bi bi-check-lg fs-4 ms-2 ng-star-inserted text-primary" *ngIf="!_.isEmpty(f.itemList.controls) && step != 2"></i>
            
                                    </div>
        
                                    <ng-container *ngIf="!_.isEmpty(f.itemList.controls) && step != 2">
        
                                        <div class="d-flex">
            
                                            <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis opacity-0"  [ngClass]="step === 2 ? 'bg-white' : 'bg-secondary-subtle'">1</div> 
            
                                            <p class="fw-600 mb-0 text-black">{{ f.qty.value }} Items</p>
            
                                        </div>
                                    
                                    </ng-container>
        
                                </div>
        
                                <div class="d-block">
        
                                    <button 
                                        class="btn text-primary border border-2 border-secondary-subtle btn-sm rounded px-3" 
                                        (click)="addProductsModal.open()"> ADD ITEMS
                                    </button>
        
                                    <button 
                                        class="btn text-primary border border-2 border-secondary-subtle btn-sm rounded px-3 ms-2" 
                                        *ngIf="!_.isEmpty(f.itemList.controls) && step != 2" 
                                        (click)="step = 2"> CHANGE
                                    </button>
        
                                </div>                        
        
                            </div>                    
        
                        </mat-panel-title>
        
                    </mat-expansion-panel-header>
        
                    <div class="rounded-2 p-4">
        
                        <ng-container *ngIf="_.isEmpty(f.itemList.controls);">
                
                            <p class="text-secondary">No Items Added</p>
                        
                        </ng-container>
        
                        <ng-container *ngFor="let productDet of itf.value; let productIndex = index">
        
                            <ng-container *ngFor="let priceDet of productDet.priceList; let priceIndex = index">
        
                                <div class="form-group d-flex justify-content-between" *ngIf="priceDet.qty > 0">
        
                                    <div class="d-flex py-2">
        
                                        <div class="product-img-card border border-2 rounded p-2 me-3">
        
                                            <div class="product-image" style="background : url({{productDet.productImageURL}});width: 75px;height: 75px;"></div> 
        
                                        </div>
                    
                                        <div>
                        
                                            <h6 class="align-self-center mb-0 fw-600" style="min-width: 150px;">{{productDet.productName | titlecase }}</h6>
        
                                            <p class="text-secondary fw-500 mb-3 small">{{ priceDet.chargeName | titlecase }}</p>
                                            
                                            <div class="d-flex align-items-center" [formGroup]="itf.at(productIndex).get('priceList').at(priceIndex)">
        
                                                <i class="bx bx-cart fs-4 me-3 text-primary"></i>
    
                                                <select class="form-control form-control-sm border-2" formControlName="qty" (change)="changeValue({ fieldName: 'productQty', 'index': productIndex, 'indexTwo': priceIndex })">
        
                                                    <option *ngFor="let value of _.range(1, 50)" [value]="value">{{ value }}</option>
    
                                                </select>
    
                                                <p class="ms-2 mb-0 small fw-600">{{ priceDet.amount }}</p>
    
                                                <p class="ms-2 mb-0 small fw-600">{{ service.currencyDetails.currencyCode }}</p>
                                                
                                            </div>
                        
                                        </div>
                        
                                    </div>
    
                                    <div class="d-flex py-2 flex-column align-items-end justify-content-between">
    
                                        <a class="text-danger" (click)="removeBasketItem({ productIndex, priceIndex })">
                                                    
                                            <i class="bi bi-trash3 me-2"></i> Delete
                                        
                                        </a>
        
                                        <h6 class="fw-600 mb-0">{{ priceDet.netAmt + ' ' + service.currencyDetails.currencyCode }}</h6>
    
                                    </div>
        
                                </div>
        
                            </ng-container>
        
                        </ng-container>
        
                        <ng-container *ngIf="!_.isEmpty(itf.value)">
                                    
                            <button 
                                class="btn btn-primary btn-sm rounded px-5" 
                                (click)="goNext({ 'nextStep': 3 })">
                                SET PICKUP & DELIVERY TIME
                            </button>
        
                        </ng-container>
        
                    </div>
            
                </mat-expansion-panel>
                
                <mat-expansion-panel class="mat-elevation-z1 border" [ngClass]="{ 'mb-3': step != 3 }" [expanded]="step === 3" hideToggle disabled>
            
                    <mat-expansion-panel-header class="px-1 rounded-0 px-3" [ngClass]="{ 'bg-primary-subtle': step === 3 }" style="height: 60px !important;">
        
                        <mat-panel-title class="fw-600 mat-expansion-panel-header-title" [ngClass]="step === 3 ? 'text-primary-emphasis' : 'text-secondary'"> 
                            
                            <div class="lh-1 me-2 px-2 py-1 small text-primary-emphasis" [ngClass]="step === 3 ? 'bg-white' : 'bg-secondary-subtle'">4</div> PICKUP & DELIVERY TIME
                        
                        </mat-panel-title>
        
                    </mat-expansion-panel-header>
        
                    <div class="rounded-2 py-3 px-2" [formGroup]="orderForm">
    
                        <div class="pt-3 px-4" style="max-width: 600px;">
            
                            <div class="d-flex align-items-center justify-content-between">
    
                                <h6 for="orderType" class="d-flex align-items-center fw-600 mb-0">
                                    
                                    <img src="./assets/images/pickup-clock.svg" class="me-2" style="width: 36px;">
                                    
                                    Urgent/Normal
                                
                                </h6>
    
                                <div>
    
                                    <input type="checkbox" id="orderType" class="toggle" formControlName="orderType" [checked]="f.orderType.value == 'normal'" (change)="changeValue({ fieldName: 'orderType' })">
    
                                    <label for="orderType" style="width: 110px">
                                        
                                        <span class="on">Normal</span>
                                        
                                        <span class="off">Urgent</span>
                                    
                                    </label>
    
                                </div>
    
                            </div>
    
                            <div class="d-flex align-items-center my-3">
    
                                <label for="pickupDate" class="text-secondary fw-600 me-2">Pickup Time</label>
    
                                <input type="checkbox" id="pickupAvailable" class="toggle toggle-sm" formControlName="pickupAvailable" [checked]="f.pickupAvailable.value">
    
                                <label for="pickupAvailable">
                                    
                                    <span class="on">Yes</span>
                                    
                                    <span class="off">No</span>
                                
                                </label>
    
                            </div>
    
                            <div class="d-flex align-items-center justify-content-between mb-2">
    
                                <div class="pe-1 w-100 position-relative">
    
                                    <input class="form-control form-control-lg border-2" type="text" id="pickupDate" formControlName="pickupDate" placeholder="Select Date" [ngClass]="{ 'is-invalid': (formSubmitted.orderForm || f.pickupDate.touched) && f.pickupDate.errors }" (dateChange)="f.pickupDate.setValue(moment($event.value).format('YYYY-MM-DD'));getTimeSlots({ 'fieldName': 'pickupDate' })" [matDatepickerFilter]="checkIsWorkingDay" [matDatepicker]="pickupDatepicker" readonly>
    
                                    <i class="bi bi-calendar position-absolute text-secondary cursor-pointer" (click)="pickupDatepicker.open()" style="right: 0.75rem;top: 1rem;"></i>
    
                                    <mat-datepicker #pickupDatepicker></mat-datepicker>
                                    
                                </div>
    
                                <div class="ps-1 w-100">
    
                                    <ng-select class="form-control border-2" formControlName="pickupTimeSlot" [ngClass]="{ 'is-invalid': (formSubmitted.orderForm || f.pickupTimeSlot.touched) && f.pickupTimeSlot.errors }" appendTo="body" [clearable]="false" [searchable]="false" placeholder="Select Time Slot" [readonly]="_.isEmpty(masterList?.pickupDate?.timeSlots)">
                                    
                                        <ng-option *ngFor="let slotDet of masterList?.pickupDate?.timeSlots" [value]="slotDet._id">
                                            
                                            {{ slotDet.label }}
                                        
                                        </ng-option>
    
                                    </ng-select>
    
                                </div>
    
                            </div>
    
                            <div class="d-flex align-items-center my-3">
    
                                <label for="expDeliveryDate" class="text-secondary fw-600 me-2">Expected Delivery Time</label>
    
                                <input type="checkbox" id="deliveryAvailable" class="toggle toggle-sm" formControlName="deliveryAvailable" [checked]="f.deliveryAvailable.value">
    
                                <label for="deliveryAvailable">
                                    
                                    <span class="on">Yes</span>
                                    
                                    <span class="off">No</span>
                                
                                </label>
    
                            </div>                                        
    
                            <div class="d-flex align-items-center justify-content-between mb-2">
    
                                <div class="pe-1 w-100 position-relative">
    
                                    <input class="form-control form-control-lg border-2" type="text" id="expDeliveryDate" formControlName="expDeliveryDate" placeholder="Select Date" [ngClass]="{ 'is-invalid': (formSubmitted.orderForm || f.expDeliveryDate.touched) && f.expDeliveryDate.errors }" (dateChange)="f.expDeliveryDate.setValue(moment($event.value).format('YYYY-MM-DD'));getTimeSlots({ 'fieldName': 'expDeliveryDate' })"  [matDatepickerFilter]="checkIsWorkingDay" [matDatepicker]="expDeliveryDatepicker" readonly>
    
                                    <i class="bi bi-calendar position-absolute text-secondary cursor-pointer" (click)="expDeliveryDatepicker.open()" style="right: 0.75rem;top: 1rem;"></i>
    
                                    <mat-datepicker #expDeliveryDatepicker></mat-datepicker>
                                    
                                </div>
    
                                <div class="ps-1 w-100">
    
                                    <ng-select class="form-control border-2" formControlName="expDeliveryTimeSlot" [ngClass]="{ 'is-invalid': (formSubmitted.orderForm || f.expDeliveryTimeSlot.touched) && f.expDeliveryTimeSlot.errors }" appendTo="body" [clearable]="false" [searchable]="false" placeholder="Select Time Slot" [readonly]="_.isEmpty(masterList?.expDeliveryDate?.timeSlots)">
                                    
                                        <ng-option *ngFor="let slotDet of masterList?.expDeliveryDate?.timeSlots" [value]="slotDet._id">
                                            
                                            {{ slotDet.label }}
                                        
                                        </ng-option>
    
                                    </ng-select>
    
                                </div>                                            
    
                            </div>                                        
    
                        </div>                    
        
                    </div>
            
                </mat-expansion-panel>            
            
            </mat-accordion>        
    
        </div>
    
        <div class="col-xxl-3 col-xl-4 col-lg-5">

            <div class="card border-0 mat-elevation-z2">

                <div class="card-header bg-white text-secondary py-3 border-bottom">

                    <h6 class="fw-600 mb-0">Order Summary</h6>

                </div>

                <div class="card-body py-2 px-4">

                    <div class="d-flex justify-content-between mb-1 mt-2">

                        <p>Price <span *ngIf="f.qty.value > 0">({{ f.qty.value }} Item) </span> </p>

                        <p class="fw-600 mb-0">{{ f.grossAmt.value + ' ' + service.currencyDetails.currencyCode }}</p>

                    </div>

                    <div class="d-flex justify-content-between mb-1" [ngClass]="f.grossAmt.value > 0 && !_.isEmpty(selectedCustomerDet) ? 'align-items-center' : ''">

                        <p class="d-flex align-items-center">
                            
                            Discount

                            <a *ngIf="f.grossAmt.value > 0 && !_.isEmpty(selectedCustomerDet)" class="text-primary fw-500 mb-0 d-flex align-items-center bg-primary-subtle px-2 py-1 ms-2 rounded-pill" (click)="openAsidebar({ canvasName: 'addDiscount' })">
                            
                                {{ f.discApplied.value ? 'Change' : 'Apply' }}
    
                                <img src="./assets/images/discount.svg" class="ms-2" alt="">
                            
                            </a>  
                        
                        </p>

                        <p class="fw-600 mb-0">{{ (f.discAmt.value || 0) + ' ' + service.currencyDetails.currencyCode }}</p>

                    </div>

                    <div class="d-flex justify-content-between">

                        <p>Delivery Charges</p>

                        <p class="fw-600 mb-0">{{ f.deliveryCharges.value + ' ' + service.currencyDetails.currencyCode }}</p>

                    </div>

                    <hr class="mt-0">

                    <div class="d-flex justify-content-between">

                        <p>Net Amount</p>

                        <p class="fw-600 mb-0">{{ f.netAmt.value + ' ' + service.currencyDetails.currencyCode }}</p>

                    </div>

                    <button class="btn btn-lg btn-primary fw-light fs-6 w-100 mb-2" (click)="submit()">
        
                        <i class="bi bi-file-earmark-plus"></i>
                        
                        Create New Order
                    
                    </button>

                </div>

            </div>
    
        </div>
        
    </div>

</div>

<asidebar #canvas [title]="canvasConfig['canvasTitle']" [openCanvas]="openCanvas" [showCancelBtn]="canvasConfig['showCancelBtn']" [cancelBtnTxt]="canvasConfig['cancelBtnTxt']" [applyBtnTxt]="canvasConfig['applyBtnTxt']" [ngClass]="{ 'z-index-1060': canvasConfig['canvasName'] == 'addBasket'}" (onClose)="openCanvas = false" (onCancel)="asidebarCancel()" (onSubmit)="asidebarSubmit()" >
  
    <ng-container *ngIf="canvasConfig['canvasName'] == 'addCustomer'">
    
        <div class="row" *ngIf="customerForm" [formGroup]="customerForm">

            <div class="col-sm-6 pe-sm-1">
    
                <div class="form-group">
    
                    <label for="firstName"> First Name </label>
                    
                    <input type="text" class="form-control form-control-lg" id="firstName" formControlName="firstName" placeholder="Enter Name" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.firstName.touched) && cusf.firstName.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.firstName.touched) && cusf.firstName.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.firstName.errors.required">First Name is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="col-sm-6 ps-sm-1">
    
                <div class="form-group">
    
                    <label for="lastName"> Last Name </label>
                    
                    <input type="text" class="form-control form-control-lg" id="lastName" formControlName="lastName" placeholder="Enter Name" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.lastName.touched) && cusf.lastName.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.lastName.touched) && cusf.firstName.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.lastName.errors.required">Last Name is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="form-group">
    
                <label for="mobile">Mobile Number</label>
    
                <div class="input-group">
                
                    <div class="input-group-prepend me-1">
                
                        <ng-select formControlName="dialCode" [clearable]="false" placeholder="+91" class="form-control"
                            [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.dialCode.touched) && cusf.dialCode.errors }">
                
                            <ng-option *ngFor="let dialCodeDet of masterList['dialCodeList']" [value]="dialCodeDet.dialCode">
                
                                <img class="country-flag" alt="{{ dialCodeDet.iso2 }}"
                                    src="http://purecatamphetamine.github.io/country-flag-icons/3x2/{{ dialCodeDet['iso2'] }}.svg" /> {{
                                dialCodeDet.dialCode }}
                
                            </ng-option>
                
                        </ng-select>
                
                    </div>
                
                    <input type="text" class="form-control" id="mobile" formControlName="mobile" placeholder="Enter"
                        [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.mobile.touched) && cusf.mobile.errors }" numbersOnly maxlength="10">
                
                    <div *ngIf="(formSubmitted.customerForm || cusf.mobile.touched) && cusf.mobile.errors" class="invalid-feedback">
                
                        <div *ngIf="cusf.mobile.errors.required">Mobile number is required</div>
                
                    </div>
                
                </div>
    
            </div>
    
            <div class="col-md-8 pe-2 pe-md-1">
    
                <div class="form-group">
    
                    <label for="email"> Email </label>
                    
                    <input type="email" class="form-control form-control-lg" id="email" formControlName="email" placeholder="Enter Email" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || cusf.email.touched) && cusf.email.errors }">
        
                    <div *ngIf="(formSubmitted.customerForm || cusf.email.touched) && cusf.email.errors" class="invalid-feedback">
            
                        <div *ngIf="cusf.email.errors.required">Email is required</div>
        
                    </div>
        
                </div>
    
            </div>
    
            <div class="col-md-4 ps-2 ps-md-1">            
    
                <div class="form-group">
    
                    <label for="gender">Gender</label>
    
                    <ng-select class="form-control form-control-lg border-2" placeholder="Select Gender" formControlName="gender" [clearable]="false">
    
                        <ng-option *ngFor="let gender of ['male','female','others']" [value]="gender">
    
                            {{ gender | uppercase }}
    
                        </ng-option>
    
                    </ng-select>
    
                </div>
    
            </div>
    
            <ng-container [formGroup]="cusf.addressDetails">
    
                <div class="form-group mb-4">
                
                    <label for="street">NO & STREET/ROAD *</label>
    
                    <input type="text" class="form-control form-control-lg" id="street" formControlName="street"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.street.touched) && adf.street?.errors }">
    
                </div>
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group mb-4">
    
                        <label for="building">APARTMENT, BUILDING, FLAT</label>
    
                        <input type="text" class="form-control form-control-lg" id="building" formControlName="building"  autocomplete="off">
    
                    </div>
    
                </div>
    
                <div class="col-md-6 ps-2 ps-md-1">            
    
                    <div class="form-group mb-4">
    
                        <label for="block">BLOCK</label>
    
                        <input type="text" class="form-control form-control-lg" id="block" formControlName="block"  autocomplete="off">
    
                    </div>
    
                </div>

                <div class="col-md-6 pe-2 pe-md-1">            
    
                    <div class="form-group mb-4">
    
                        <label for="others">Others</label>
    
                        <input type="text" class="form-control form-control-lg" id="others" formControlName="others" autocomplete="off">
    
                    </div>
    
                </div>                
    
                <div class="col-md-6 ps-2 ps-md-1">
    
                    <div class="form-group">
    
                        <label for="countryId">Country</label>
    
                        <ng-select formControlName="countryId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.countryId?.touched) && adf.countryId?.errors }">
    
                            <ng-option *ngFor="let countryDet of masterList['countryList']" [value]="countryDet._id">
                                
                                {{ countryDet.name | uppercase }}
                        
                            </ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || adf.countryId?.touched) && adf.countryId?.errors" class="invalid-feedback">
    
                            <div *ngIf="adf.countryId.errors.required">Country is required</div>
    
                        </div>
    
                    </div>
    
                </div>
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group">
    
                        <label for="stateId">State</label>
    
                        <ng-select formControlName="stateId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.stateId.touched) && adf.stateId?.errors }" [readonly]="_.size(masterList['stateList']) == 0">
    
                            <ng-option *ngFor="let stateDet of masterList['stateList']" [value]="stateDet._id">{{ stateDet.name | uppercase }}</ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || adf.stateId.touched) && adf.stateId.errors" class="invalid-feedback">
    
                            <div *ngIf="adf.stateId.errors.required">State is required</div>
    
                        </div>
    
                    </div>
    
                </div>
    
                <div class="col-md-6 ps-2 ps-md-1">
    
                    <div class="form-group">
    
                        <label for="cityId">City</label>
    
                        <ng-select formControlName="cityId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.cityId.touched) && adf.cityId?.errors }"  [readonly]="_.size(masterList['cityList']) == 0">
    
                            <ng-option *ngFor="let cityDet of masterList['cityList']" [value]="cityDet._id">{{ cityDet.name | uppercase }}</ng-option>
    
                        </ng-select>
    
                        <div *ngIf="(formSubmitted.customerForm || adf.cityId.touched) && adf.cityId.errors" class="invalid-feedback">
    
                            <div *ngIf="adf.cityId.errors.required">City is required</div>
    
                        </div>
    
                    </div>                                
    
                </div>   
    
                <div class="col-md-6 pe-2 pe-md-1">
    
                    <div class="form-group">
    
                        <label for="areaId">Area</label>
    
                        <ng-select formControlName="areaId" [clearable]="false" placeholder="Select" class="form-control" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.areaId?.touched) && adf.areaId?.errors }" [readonly]="_.size(masterList['areaList']) == 0">
    
                            <ng-option *ngFor="let areaDet of masterList['areaList']" [value]="areaDet._id">{{ areaDet.name | uppercase }}</ng-option>
    
                        </ng-select>                                        
    
    
                        <div *ngIf="(formSubmitted.customerForm || adf.areaId?.touched) && adf.areaId.errors" class="invalid-feedback">
    
                            <div *ngIf="adf.areaId.errors.required">Area is required</div>
    
                        </div>
    
                    </div>                                
    
                </div> 
                
                <div class="col-sm-6 ps-2 ps-md-1">
    
                    <div class="form-group">
    
                        <label for="zipcode">PINCODE *</label>
        
                        <input type="text" class="form-control form-control-lg" id="zipcode" formControlName="zipcode"  autocomplete="off" name="hidden" [ngClass]="{ 'is-invalid': (formSubmitted.customerForm || adf.zipcode.touched) && adf.zipcode?.errors }">
    
                        <div *ngIf="(formSubmitted.customerForm || adf.zipcode?.touched) && adf.zipcode?.errors" class="invalid-feedback">
    
                            <div *ngIf="adf.zipcode.errors.required">Pincode is required</div>
    
                        </div>
        
                    </div>
    
                </div>
    
            </ng-container>     
    
        </div>    

    </ng-container>

    <ng-container *ngIf="canvasConfig['canvasName'] == 'addBasket'">

        <h6 class="text-secondary">PRODUCT INFO</h6>

        <div class="d-flex pt-2 pb-4 align-items-center">

            <div class="product-image" style="background : url({{bf.productImageURL.value}});width: 150px;height: 150px;"></div>

            <h5 class="ms-2 mb-0 fw-600">{{ bf.productName.value | titlecase }}</h5>

        </div>

        <div class="form-group d-flex align-items-center justify-content-between"  *ngFor="let priceDet of bf.priceList.value; let index = index">

            <div class="d-flex align-items-center py-2">

                <div class="product-image me-3" style="background : url({{priceDet.imgURL}});width: 40px;height: 40px;"></div> 

                <div>

                    <h6 class="align-self-center mb-0 fw-600" style="min-width: 150px;">{{priceDet.chargeName | titlecase }}</h6>

                    <p class="text-primary mb-0 fw-500 small">{{ priceDet.amount +' '+ service.currencyDetails.currencyCode }}</p>

                </div>

            </div>

            <div class="d-flex align-items-center" *ngIf="bf.priceList.at(index) as priceForm">

                <div class="input-group">

                    <button class="btn border-0 shadow-none bx bx-minus fw-600 fs-4 text-primary" (click)="changeValue({ 'fieldName': 'qty', index, 'data': -1 })"></button>

                    <input class="form-control form-control-lg text-center border-0 bg-primary-subtle mx-2 text-primary fw-bold" style="width: 55px;" [value]="priceForm.value.qty" (change)="changeValue({ 'fieldName': 'qty', index })" readonly>

                    <button class="btn border-0 shadow-none bx bx-plus fw-600 fs-4 text-primary" (click)="changeValue({ 'fieldName': 'qty', index, 'data': 1 })"></button>

                </div>

            </div>

        </div>

        <hr class="mt-5">

        <div class="d-flex justify-content-between pt-3 px-3">

            <h6 class="fw-500">Total</h6>

            <h5 class="text-primary fw-bold">{{ bf.netAmt.value +' '+ service.currencyDetails.currencyCode }}</h5>

        </div>

    </ng-container>

    <ng-container *ngIf="canvasConfig['canvasName'] == 'addDiscount'">
    
        <div class="d-flex" [formGroup]="orderForm">

            <div class="d-flex align-items-center me-2">

                <a class="px-3 d-flex align-items-center h-100 border" [ngClass]="f.discType.value == 'percentage' ? 'border-primary-subtle bg-secondary-subtle' : 'border-end-0 text-secondary'" (click)="f.discType.setValue('percentage')">
                    
                    <i class="bi bi-percent"></i>
                
                </a>

                <a class="px-3 d-flex align-items-center h-100 border" [ngClass]="f.discType.value == 'flat' ? 'border-primary-subtle bg-secondary-subtle' : 'border-start-0 text-secondary'" (click)="f.discType.setValue('flat')">

                    {{ service.currencyDetails.currencyCode }}

                </a>

            </div>

            <ng-container *ngIf="f.discType.value == 'flat'">
            
                <input type="text" class="form-control form-control-lg rounded-0" formControlName="discAmt" placeholder="Enter amount" decimalNumbersOnly (change)="calculateOrderFormValue()">

            </ng-container>

            <ng-container *ngIf="f.discType.value == 'percentage'">
            
                <input type="text" class="form-control form-control-lg rounded-0" formControlName="discPercentage" placeholder="Enter percentage" decimalNumbersOnly [decimalPoints]="2" (change)="calculateOrderFormValue()">

            </ng-container>

        </div>

    </ng-container>

</asidebar>

<modal #customerVerificationModal title="Customer Verification OTP" modalBodyClass="p-4" size="md" [showCancelBtn]="false" [showSaveBtn]="false" [showCloseIcon]="false">

    <div class="text-center" *ngIf="!f.isExistingCustomer.value && _.isEmpty(selectedCustomerDet) ? 'true' : 'false' as newCustomer">

        <p class="small text-light">
            To {{ newCustomer == 'true' ? 'create new customer details in ' : 'add existing customer details to ' }} your company's customer list, we need to verify confimation from the customer's side.
        </p>

        <div class="d-flex justify-content-center pt-3">

            <input type="text" id="otp-inp-1" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[0]" maxlength="1" (keydown)="keydown({ 'event': $event,'nextElement': '#otp-inp-1' })" autocomplete="off" style="width: 60px;height: 60px;">

            <input type="text" id="otp-inp-2" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[1]" maxlength="1" (keydown)="keydown({ 'event': $event,'nextElement': '#otp-inp-3', 'prevElement': '#otp-inp-1' })" autocomplete="off" style="width: 60px;height: 60px;">

            <input type="text" id="otp-inp-3" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[2]" maxlength="1" (keydown)="keydown({ 'event': $event,'nextElement': '#otp-inp-4', 'prevElement': '#otp-inp-2' })" autocomplete="off" style="width: 60px;height: 60px;">

            <input type="text" id="otp-inp-4" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[3]" maxlength="1" (keydown)="keydown({ 'event': $event,'nextElement': '#otp-inp-5', 'prevElement': '#otp-inp-3' })" autocomplete="off" style="width: 60px;height: 60px;">

            <input type="text" id="otp-inp-5" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[4]" maxlength="1" (keydown)="keydown({ 'event': $event,'nextElement': '#otp-inp-6', 'prevElement': '#otp-inp-4' })" autocomplete="off" style="width: 60px;height: 60px;">

            <input type="text" id="otp-inp-6" class="form-control text-center border-0 bg-primary-subtle rounded-0 mx-2" [(ngModel)]="otp[5]" maxlength="1" (keydown)="keydown({ 'event': $event, 'nextElement': '#otp-submit', 'prevElement': '#otp-inp-5' })" autocomplete="off" style="width: 60px;height: 60px;">

        </div>    
        
        <div class="text-center">

            <p class="small mt-4">

                <ng-container *ngIf="timer > 0">
                
                    OTP Expires in <span class="h6" [ngClass]="timer > 0 && timer < 10 ? 'text-danger' : 'text-light-emphasis'">{{ timer | number: '2.0-0' }}</span>s

                </ng-container>

                <ng-container *ngIf="timer <= 0">
                
                    <span class="text-light">OTP Expired</span>

                </ng-container>

            </p>

            <p class="small">

                Didn't get the OTP? &nbsp;

                <a class="text-primary small cursor-pointer text-decoration-underline" [ngClass]="{ 'opacity-50': timer > 0 }" (click)="timer > 0 ? '' : sendCustomerVerification({ 'newCustomer': newCustomer == 'true' })">Resend OTP</a>

            </p>

        </div>

        <div class="d-flex justify-content-center mt-4">

            <button class="btn btn-primary py-2 px-5 fw-normal me-2" id="otp-submit" [disabled]="_.size(_.join(otp,'')) != 6" (click)="verifyCustomerOtp()">Verify</button>
            
            <button class="btn py-2 px-5 btn-outline-primary text-primary fw-normal" style="background-color: #F3F5F9;" (click)="customerVerificationModal.close()">Cancel</button>

        </div>

    </div>


</modal>

<modal #orderPreviewModal title="Order Details" modalBodyClass="p-0" [isFullModal]="true" [showCancelBtn]="false" [showSaveBtn]="false">

    <div class="d-flex order-preview">

        <div class="card w-50 mt-5 ms-5 border-0 mat-elevation-z3" style="border-radius: 18px 18px 0 0">

            <div class="card-header bg-secondary rounded-top-pill"></div>

            <div class="card-body">

                <h6 class="text-secondary">AGENT DETAILS</h6>

                <div class="d-flex align-items-center py-2">

                    <img src="./assets/images/default-company-logo.svg">

                    <div class="ms-3">

                        <h5 class="mb-0 fw-600">{{ service.companyDetails.companyName }}</h5>

                        <p class="mb-0 fw-500 text-light small" *ngIf="service.companyDetails.addressDetails as addressDet">
                            
                            {{ addressDet.areaId.name }}, {{ addressDet.cityId.name }}, {{ addressDet.stateId.name }}
                        
                        </p> 

                    </div>

                </div>

                <h6 class="text-secondary mt-3">CUSTOMER DETAILS</h6>

                <div class="d-flex align-items-start py-3">
        
                    <div class="customer-image product-image mt-3" style="background: url({{selectedCustomerDet?.customerImageURL}}); width: 35px; height: 35px;"></div>

                    <div class="ms-3">

                        <h5 class="fw-600">{{selectedCustomerDet?.firstName + ' ' + selectedCustomerDet?.lastName}}</h5>

                        <p class="fw-500 text-light" *ngIf="selectedCustomerDet?.addressInfo as addressDet">
    
                            {{ addressDet?.street }}, 
                            {{ !_.isEmpty(addressDet?.block) ? addressDet?.block + ',' : ''}} 
                            {{ !_.isEmpty(addressDet?.building) ? addressDet?.building + ',' : '' }}
                            {{ addressDet?.areaId?.name }}, <br>
                            {{ addressDet?.cityId?.name }}, 
                            {{ addressDet?.countryId?.name }} - 
                            {{ addressDet?.zipcode }}
    
                        </p>
        
                    </div>

                </div>

                <h6 class="text-secondary mt-3">ORDER STATUS</h6>

                <h6 class="fw-500 p-3 text-secondary bg-light w-75">{{ f.orderStatus.value }}</h6>

                <h6 class="text-secondary mt-3">READY AT</h6>

                <h6 class="fw-600">{{ f.expDeliveryDate.value | date: 'EEE  ddMMM  yyyy' }}</h6>

                <h6 class="fw-500 small text-light">{{ f.expDeliveryTimeSlotDet.value?.label }}</h6>

                <div class="d-flex align-items-center">

                    <div class="me-5">

                        <h6 class="text-secondary mt-3">CREATED BY</h6>
    
                        <h6>{{ service.userDetails.name | uppercase }}</h6>

                    </div>

                    <div>

                        <h6 class="text-secondary mt-3">CREATED ON</h6>
    
                        <h6>{{ f.orderDate.value | date: 'EEE dd,yyyy' }}</h6>

                    </div>


                </div>

            </div>

        </div>

        <div class="create-order-section border-2 border-start">

            <div class="card-body" [formGroup]="orderForm">
    
                <mat-accordion multi>
    
                    <!-- <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">
    
                        <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white" >
    
                            <div class="mb-0 text-primary fw-500 small">Item Summary ({{ f.qty.value }})</div>
    
                        </mat-expansion-panel-header>
    
                        <div class="pt-3 px-4">
                            
                            <div style="min-height: 175px;">

                                <ng-container  *ngFor="let productDet of this.itf.value; let index = index">

                                    <ng-container *ngFor="let priceDet of productDet.priceList">

                                        <div class="form-group d-flex align-items-center justify-content-between" *ngIf="priceDet.qty > 0">

                                            <div class="d-flex py-2">

                                                <div class="product-img-card border border-2 rounded p-2 me-3">

                                                    <div class="product-image" style="background : url({{productDet.productImageURL}});width: 75px;height: 75px;"></div> 

                                                </div>
                            
                                                <div>
                                
                                                    <h6 class="align-self-center mb-0 fw-600" style="min-width: 150px;">{{productDet.productName | titlecase }}</h6>

                                                    <p class="text-secondary fw-500 mb-3 small">{{ priceDet.chargeName | titlecase }}</p>
                                                    
                                                    <div class="d-flex align-items-center">

                                                        <p class="text-secondary mb-0 fw-500 small">{{ priceDet.amount +' '+ service.currencyDetails.currencyCode }}</p>

                                                    </div>
                                
                                                </div>
                                
                                            </div>

                                            <div class="d-flex align-items-center">

                                                <i class="fw-500 bx bx-x fs-6 text-secondary"></i>

                                                <p class="fw-600 mb-0">{{priceDet.qty}}</p>

                                            </div>

                                            <h6 class="mb-0 fw-600">{{ priceDet.netAmt + ' ' + service.currencyDetails.currencyCode }}</h6>

                                        </div>

                                    </ng-container>

                                </ng-container>

                            </div>
    
                        </div>
    
                    </mat-expansion-panel>
    
                    <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true">

                        <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white">

                            <div class="mb-0 text-primary fw-500 small">Check Out</div>

                        </mat-expansion-panel-header>

                        <div class="mt-3" style="min-height: 175px;">

                            <div class="d-flex justify-content-between align-items-center px-4">

                                <h6 class="text-secondary fw-500 mb-0">Subtotal</h6>

                                <h6 class="mb-0 fw-600">{{ f.grossAmt.value + ' ' + service.currencyDetails.currencyCode }}</h6>

                            </div>

                            <div class="d-flex justify-content-between align-items-center mt-3 px-4">

                                <p class="text-primary fw-500 mb-0 d-flex align-items-center bg-primary-subtle px-2 py-1 rounded-pill">

                                    <img src="./assets/images/discount.svg" class="me-2" alt="">
                                    
                                    Discount
                                
                                </p>

                                <h6 class="mb-0 fw-600">{{ f.discAmt.value + ' ' + service.currencyDetails.currencyCode }}</h6>

                            </div>                                        

                            <hr>

                            <div class="d-flex justify-content-between align-items-center px-4">

                                <h6 class="text-secondary fw-500 mb-0">Total</h6>

                                <h6 class="mb-0 fw-600">{{ f.netAmt.value + ' ' + service.currencyDetails.currencyCode }}</h6>

                            </div>                                            

                        </div>

                    </mat-expansion-panel> -->

                    <mat-expansion-panel class="mat-elevation-z0 rounded-0 my-0" [expanded]="true" disabled hideToggle>

                        <mat-expansion-panel-header class="card-section-header bg-primary-subtle px-3 py-2 border-bottom border-2 border-white">

                            <div class="mb-0 text-primary fw-500 small">Payment Method</div>

                        </mat-expansion-panel-header>

                        <div class="my-3" style="min-height: 175px;">

                            <div class="px-4">

                                <mat-radio-group class="d-flex justify-content-around align-items-center pb-3" formControlName="paymentOnDelivery">
    
                                    <button class="btn fs-6 opt-btn text-start w-50 me-2" [ngClass]="{ 'active': !f.paymentOnDelivery?.value }" (click)="f.paymentOnDelivery.setValue(false)"> 
                                            
                                        <mat-radio-button [value]="false">Pay Now</mat-radio-button>
                                    
                                    </button>                            
                                    
                                    <button class="btn fs-6 opt-btn text-start w-50 ms-2" [ngClass]="{ 'active': f.paymentOnDelivery?.value }" (click)="f.paymentOnDelivery.setValue(true)"> 
                                            
                                        <mat-radio-button [value]="true">Pay on Delivery</mat-radio-button>
                                    
                                    </button>
    
                                </mat-radio-group>
    
                                <hr>

                            </div>

                            <ng-container *ngIf="!f.paymentOnDelivery.value">

                                <div class="px-4">

                                    <mat-radio-group formControlName="paymentMode">
    
                                        <div class="d-flex justify-content-around align-items-centerpt-3">
        
                                            <button class="btn fs-6 opt-btn text-start w-50 me-2 position-relative" [ngClass]="{ 'active': f.paymentMode.value == 'Benifit' }" (click)="f.paymentMode.setValue('Benifit')"> 
                                                    
                                                <mat-radio-button value="Benifit">Benifit</mat-radio-button>
        
                                                <img src="./assets/images/card-payment-types.svg" class="position-absolute end-0 me-2 mt-2">
                                            
                                            </button>                            
                                            
                                            <button class="btn fs-6 opt-btn text-start w-50 ms-2 position-relative" [ngClass]="{ 'active': f.paymentMode.value == 'Credit Card' }" (click)="f.paymentMode.setValue('Credit Card')"> 
                                                    
                                                <mat-radio-button value="Credit Card">Credit Card</mat-radio-button>
        
                                                <img src="./assets/images/card-payment-types.svg" class="position-absolute end-0 me-2 mt-2">
                                            
                                            </button>
        
                                        </div>
        
                                        <div class="d-flex justify-content-around align-items-center mt-4">
        
                                            <button class="btn fs-6 opt-btn text-start w-50 me-2" [ngClass]="{ 'active': f.paymentMode.value == 'Cash' }" (click)="f.paymentMode.setValue('Cash')"> 
                                                    
                                                <mat-radio-button value="Cash">Cash</mat-radio-button>
                                            
                                            </button>                            
                                            
                                            <button class="btn fs-6 opt-btn text-start w-50 ms-2" [ngClass]="{ 'active': f.paymentMode.value == 'UPI/Others' }" (click)="f.paymentMode.setValue('UPI/Others')"> 
                                                    
                                                <mat-radio-button value="UPI/Others">UPI/Others</mat-radio-button>
                                            
                                            </button>
        
                                        </div>                                
        
                                    </mat-radio-group>                                    

                                </div>                                

                                <hr>

                                <div class="d-flex justify-content-between align-items-center px-4">

                                    <h6 class="text-secondary fw-500 mb-0">Amount Received</h6>

                                    <div class="d-flex align-items-center justify-content-end">

                                        <h6 class="mb-0 fw-600 text-primary">{{ service.currencyDetails.currencyCode }}</h6>

                                        <input type="text" class="form-control form-control-lg border-0 bg-secondary-subtle w-50 rounded-0 ms-3" formControlName="paymentReceived" decimalNumbersOnly (change)="changeValue({ fieldName: 'paymentReceived' })">

                                    </div>

                                </div>

                                <div class="d-flex justify-content-between align-items-center px-4 mt-3">

                                    <h6 class="text-secondary fw-500 mb-0">Balance Paid</h6>

                                    <div class="d-flex align-items-center justify-content-end">

                                        <h6 class="mb-0 fw-600 fw-600 text-primary">{{ service.currencyDetails.currencyCode }}</h6>

                                        <input type="text" class="form-control form-control-lg border-0 bg-secondary-subtle w-50 rounded-0 ms-3" formControlName="paymentPending" readonly>

                                    </div>

                                </div>

                            </ng-container>

                        </div>

                    </mat-expansion-panel>                    
                    
                </mat-accordion>                            
    
            </div>
    
            <div class="card-footer border-top border-2 px-3 py-2 pt-3">               
    
                <button class="btn btn-primary mx-2 w-50 btn fw-light fs-6" (click)="createOrder()">
    
                    PayNow
                
                </button>

                <button class="btn btn-outline-primary mx-2 w-50 btn-lg fw-light fs-6" (click)="orderPreviewModal.close()">
    
                    Discard
                
                </button>                 
    
            </div>
    
        </div>
    
    </div>

</modal>

<modal #addProductsModal title="Add Products" modalBodyClass="p-4" size="xl" [showCloseIcon]="false" [showSaveBtn]="f.qty.value > 0" saveBtnTxt="PROCEED" (onSubmit)="addProductsModal.close()">
    
    <div class="d-flex flex-wrap align-items-center mb-2" [formGroup]="filterForm">

        <input type="text" id="searchValue" class="form-control form-control-lg border-2 me-2 mb-2 w-auto" formControlName="searchValue" placeholder="Search by item name..." (change)="getMyProducts()">

        <custom-ng-select 
            [value]="filterForm.controls.categoryId?.value"
            [from]="filterForm"     
            formControlField="categoryId"
            [multiple]="true"
            [items]="masterList['categoryList']"
            bindLabel="item?.categoryName.toTitleCase()"
            bindValue="_id"
            placeholder="Categories"
            classList="mb-2 me-2"
            (change)="getMyProducts()"
        ></custom-ng-select>

    </div>

    <div class="d-flex flex-wrap justify-content-between align-items-center mb-2">

        <div class="fw-500 text-secondary"><span class="fs-5">Products</span> ({{agentProductsCount}})</div>
        
        <div class="align-items-baseline d-flex fw-bold">

            <i class="bi bi-cart fs-5 me-2 text-primary"></i>

            <p class="fw-bold mb-0">{{ f.grossAmt.value + ' ' + service.currencyDetails.currencyCode  }}</p>

        </div>
        
    </div>

    <div class="product-section">

        <ng-container *ngIf="_.size(masterList['agentProducts']) > 0; else noRecords">

            <div class="d-flex flex-wrap">

                <a class="card product-card py-2 border-2 m-2" height="220px" *ngFor="let productDet of masterList['agentProducts']" (click)="openAsidebar({ 'canvasName': 'addBasket', 'data': productDet })">

                    <div class="bg-primary fw-500 position-absolute px-2 py-1 rounded-bottom-3 rounded-start-0 text-white top-0" *ngIf="_.includes(selectedItems,productDet?._id)">

                        <i class="bi bi-cart-check"></i> {{ _.find(this.itf.value,{ 'productId':  productDet?._id })?.qty }}

                    </div>

                    <div class="card-body">

                        <i [ngClass]="_.includes(selectedItems,productDet?._id) ? 'bi bi-pencil-square' : 'bx bx-plus rounded'"></i>

                        <div class="product-image mx-auto" style="background : url({{productDet?.productId?.productImageURL}});width: 150px;height: 150px;"></div> 

                        <div class="d-flex justify-content-center">

                            <a class="h5 mb-0 mt-3 text-center text-primary">
                                
                                {{productDet?.productId?.productName}}

                            </a>

                        </div>

                    </div>

                </a>

            </div>

        </ng-container>

        <ng-template #noRecords>

            <div class="empty-page d-flex justify-content-center align-items-center position-relative">

                <div class="empty-content">
        
                    <h4 class="fw-600">No Records Found</h4>
                
                    <div class="emptyIcon" style="background: url(./assets/images/empty-list.png);"></div>
                    
                    <!-- <a class="btn btn-md btn-primary bi bi-plus-lg" [routerLink]="'/pages/account-setup/item-pricing'" > 
                
                        <span class="ms-3">Add New</span>
                    
                    </a> -->
                    
                </div>
    
            </div>

        </ng-template> 

    </div>    

</modal> 